<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Devoluciones | Hilos y Coo</title>

  <!-- Tema violeta unificado -->
  <link rel="stylesheet" href="css/tema-violeta.css" />
  <!-- Estilos espec√≠ficos de la vista -->
  <link rel="stylesheet" href="css/devoluciones.css?v=1" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">üßµ</div>
      <h1>Devoluciones / Cambios</h1>
    </div>
    <div class="session">
      <span class="user-label">Usuario:</span>
      <span id="usuario-logueado" class="user-value">Cargando‚Ä¶</span>
      <a href="dashboard.html" class="btn">Volver</a>
      <button id="btn-logout" class="btn outline">Salir</button>
    </div>
  </header>

  <main class="wrap">
    <!-- Buscar venta -->
    <section class="panel">
      <h2 class="panel-title">Devoluciones / Cambios</h2>

      <div class="grid-2">
        <div class="grid">
          <div class="actions">
            <div class="grow">
              <label class="small" for="venta-id">N¬∞ de venta</label>
              <input type="number" id="venta-id" min="1" placeholder="Ej: 123" />
            </div>
            <button id="btn-buscar" class="btn primary sm" title="Buscar por N¬∞">Buscar</button>
            <button id="btn-abrir-modal-ventas" class="btn sm" title="Ver historial">Historial</button>
          </div>

          <div class="actions">
            <span class="tag" id="venta-resumen">Sin venta cargada</span>
            <span id="venta-total" class="pill oculto"></span>
          </div>
        </div>

        <div class="grid">
          <div>
            <label class="small">Caja a impactar</label>
            <div class="actions">
              <label><input type="radio" name="caja" value="fisica" checked> F√≠sica</label>
              <label class="ml-12"><input type="radio" name="caja" value="virtual"> Virtual</label>
            </div>
          </div>
          <div>
            <label class="small">
              <input type="checkbox" id="chk-precio-vigente"> Usar precio vigente en la variante entregada
            </label>
          </div>
        </div>
      </div>
    </section>

    <!-- √çtems de la venta -->
    <section id="panel-items" class="panel mt-16">
      <div class="muted" id="hint-items">Busc√° una venta para listar sus √≠tems‚Ä¶</div>

      <div id="tabla-wrap" class="oculto">
        <table class="tabla">
          <thead>
            <tr>
              <th class="col-id">Item</th>
              <th>Producto / Variante</th>
              <th class="right">Vendida</th>
              <th class="right">Devolver</th>
              <th>Cambio</th>
              <th class="right">P. original</th>
              <th class="right">Sub Devuelta</th>
              <th class="right">Sub Entregada*</th>
            </tr>
          </thead>
          <tbody id="items-body"></tbody>
        </table>
        <div class="muted mt-6">* Se usa precio original o vigente (si est√° activado).</div>
      </div>
    </section>

    <!-- Resumen y confirmaci√≥n -->
    <section class="panel mt-16">
      <div class="summary">
        <div class="box">
          <h4>Total devuelto</h4>
          <b id="sum-devuelto">$0,00</b>
        </div>
        <div class="box">
          <h4>Total entregado</h4>
          <b id="sum-entregado">$0,00</b>
        </div>
        <div class="box">
          <h4>Neto</h4>
          <b id="sum-neto">$0,00</b>
          <div class="muted" id="neto-label">Si es negativo: se reintegra. Si es positivo: se cobra diferencia.</div>
        </div>
      </div>

      <div class="grid mt-12">
        <div>
          <label class="small" for="motivo">Motivo (opcional)</label>
          <input type="text" id="motivo" placeholder="Ej: color incorrecto"/>
        </div>
        <div class="actions justify-end">
          <button id="btn-confirmar" class="btn primary">Confirmar devoluci√≥n/cambio</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal: Historial de ventas -->
  <div id="modal-ventas" class="modal" aria-hidden="true">
    <div class="box">
      <div class="head">
        <h3>Seleccionar venta</h3>
        <button id="mven-cerrar" class="btn sm">Cerrar</button>
      </div>

      <div class="toolbar">
        <input id="mven-buscar" type="text" placeholder="Buscar por ID, empleado‚Ä¶" />
      </div>

      <div class="scroll">
        <table class="tabla">
          <thead>
            <tr>
              <th class="col-id">ID</th>
              <th>Fecha</th>
              <th class="right">Total</th>
              <th>Empleado</th>
            </tr>
          </thead>
          <tbody id="mven-rows"></tbody>
        </table>
      </div>

      <div class="foot">
        <small class="muted">Toc√° una fila para usar esa venta.</small>
      </div>
    </div>
  </div>

  <!-- Modal: Selecci√≥n de producto y variantes -->
  <div id="modal-variantes" class="modal" aria-hidden="true">
    <div class="box">
      <div class="head">
        <h3>Elegir producto y variante para el cambio</h3>
        <button id="mvar-cerrar" class="btn sm">Cerrar</button>
      </div>

      <div class="grid-2">
        <div>
          <label class="small">Buscar producto</label>
          <div class="toolbar">
            <input id="mvar-buscar-prod" type="text" placeholder="Filtrar por nombre o ID‚Ä¶" />
            <button id="mvar-recargar-prod" class="btn sm">Recargar</button>
          </div>
          <div class="scroll">
            <table class="tabla">
              <thead>
                <tr>
                  <th class="col-id">ID</th>
                  <th>Producto</th>
                  <th class="right">Precio</th>
                </tr>
              </thead>
              <tbody id="mvar-rows-prod"></tbody>
            </table>
          </div>
        </div>

        <div>
          <label class="small">Variantes del producto seleccionado</label>
          <div class="scroll">
            <table class="tabla">
              <thead>
                <tr>
                  <th class="col-id">Var ID</th>
                  <th>Talle</th>
                  <th>Color</th>
                  <th class="right">Stock</th>
                </tr>
              </thead>
              <tbody id="mvar-rows-var"></tbody>
            </table>
          </div>
          <div class="foot">
            <small class="muted">Toc√° una variante para seleccionar.</small>
          </div>
        </div>
      </div>

      <div class="foot justify-between">
        <div class="muted" id="mvar-seleccion">Sin selecci√≥n</div>
        <button id="mvar-usar" class="btn primary" disabled>Usar esta variante</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/devoluciones.js"></script>
</body>
</html>
