<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Devoluciones | Hilos y Coo</title>
  <link rel="stylesheet" href="css/dashboard.css" />
  <style>
    /* Extras m√≠nimos para esta vista (apoya a dashboard.css) */
    .wrap{ max-width:1100px; margin:28px auto; padding:0 16px; }
    .panel{ background: rgba(17,24,39,.65); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    .grid{ display:grid; gap:12px; }
    label.small{ font-size:13px; color:#94a3b8; display:block; margin-bottom:6px; }
    input[type="number"], input[type="text"], textarea, select{
      width:100%; padding:10px 12px; background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12); color:#e5e7eb; border-radius:10px;
    }
    .actions{ display:flex; gap:10px; align-items:center; }
    .btn.sm{ padding:6px 10px; border-radius:8px; font-size:13px; }
    table{ width:100%; border-collapse: collapse; }
    th, td{ padding:10px 8px; border-bottom:1px solid rgba(255,255,255,.08); font-size:14px; vertical-align:middle; }
    th{ text-align:left; color:#94a3b8; font-weight:600; }
    .right{ text-align:right; }
    .muted{ color:#94a3b8; font-size:13px; }
    .tag{ display:inline-block; font-size:12px; padding:2px 8px; border:1px solid rgba(255,255,255,.15); border-radius:999px; color:#94a3b8; }
    .summary{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
    .summary .box{ background:rgba(255,255,255,.04); border:1px dashed rgba(255,255,255,.12); border-radius:12px; padding:12px; }
    .summary .box h4{ margin:0 0 6px; font-size:13px; color:#94a3b8; font-weight:500; }
    .summary .box b{ font-size:18px; }
    .danger{ border-color: rgba(239,68,68,.55)!important; }
    .primary{ border-color: rgba(99,102,241,.45)!important; }
    .oculto{ display:none !important; }
    .pill{ font-size:12px; color:#a3e635; border:1px solid rgba(163,230,53,.4); padding:2px 8px; border-radius:999px; }

    /* Modales */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; padding:16px; z-index:60; }
    .modal.abierto{ display:flex; }
    .modal .box{ width:100%; max-width:960px; background:#111827; border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px; }
    .modal .head{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
    .modal .head h3{ margin:0; font-size:18px; }
    .modal .foot{ display:flex; justify-content:flex-end; gap:8px; margin-top:10px; }
    .toolbar{ display:flex; gap:8px; align-items:center; margin-bottom:10px; }
    .toolbar input{ max-width:260px; }
    .scroll{ max-height: 52vh; overflow:auto; border:1px solid rgba(255,255,255,.06); border-radius:12px; }
    .clickable:hover{ background: rgba(255,255,255,.06); cursor:pointer; }
    @media (max-width: 900px){ .grid-2{ grid-template-columns:1fr; } .summary{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">üßµ</div>
      <h1>Hilos y Coo</h1>
    </div>
    <div class="session">
      <span class="user-label">Usuario:</span>
      <span id="usuario-logueado" class="user-value">Cargando‚Ä¶</span>
      <a href="dashboard.html" class="btn" style="text-decoration:none;">Volver</a>
      <button id="btn-logout" class="btn-logout">Salir</button>
    </div>
  </header>

  <main class="wrap">
    <!-- Buscar venta -->
    <section class="panel">
      <h2 style="margin:0 0 12px;">Devoluciones / Cambios</h2>
      <div class="grid-2">
        <div class="grid">
          <div class="actions">
            <div style="flex:1;">
              <label class="small" for="venta-id">N¬∞ de venta</label>
              <input type="number" id="venta-id" min="1" placeholder="Ej: 123" />
            </div>
            <button id="btn-buscar" class="btn primary sm" title="Buscar por N¬∞">Buscar</button>
            <button id="btn-abrir-modal-ventas" class="btn sm" title="Ver historial">Historial</button>
          </div>
          <div class="actions">
            <span class="tag" id="venta-resumen">Sin venta cargada</span>
            <span id="venta-total" class="pill oculto"></span>
          </div>
        </div>
        <div class="grid">
          <div>
            <label class="small">Caja a impactar</label>
            <div class="actions">
              <label><input type="radio" name="caja" value="fisica" checked> F√≠sica</label>
              <label style="margin-left:12px;"><input type="radio" name="caja" value="virtual"> Virtual</label>
            </div>
          </div>
          <div>
            <label class="small"><input type="checkbox" id="chk-precio-vigente"> Usar precio vigente en la variante entregada</label>
          </div>
        </div>
      </div>
    </section>

    <!-- √çtems de la venta -->
    <section id="panel-items" class="panel" style="margin-top:16px;">
      <div class="muted" id="hint-items">Busc√° una venta para listar sus √≠tems‚Ä¶</div>
      <div id="tabla-wrap" class="oculto">
        <table>
          <thead>
            <tr>
              <th>Item</th>
              <th>Producto / Variante</th>
              <th class="right">Vendida</th>
              <th class="right">Devolver</th>
              <th>Cambio</th>
              <th class="right">P. original</th>
              <th class="right">Sub Devuelta</th>
              <th class="right">Sub Entregada*</th>
            </tr>
          </thead>
          <tbody id="items-body"></tbody>
        </table>
        <div class="muted" style="margin-top:6px;">* Se usa precio original o vigente (si est√° activado).</div>
      </div>
    </section>

    <!-- Resumen y confirmaci√≥n -->
    <section class="panel" style="margin-top:16px;">
      <div class="summary">
        <div class="box">
          <h4>Total devuelto</h4>
          <b id="sum-devuelto">$0,00</b>
        </div>
        <div class="box">
          <h4>Total entregado</h4>
          <b id="sum-entregado">$0,00</b>
        </div>
        <div class="box">
          <h4>Neto</h4>
          <b id="sum-neto">$0,00</b>
          <div class="muted" id="neto-label">Si es negativo: se reintegra. Si es positivo: se cobra diferencia.</div>
        </div>
      </div>

      <div class="grid" style="margin-top:12px;">
        <div>
          <label class="small" for="motivo">Motivo (opcional)</label>
          <input type="text" id="motivo" placeholder="Ej: color incorrecto"/>
        </div>
        <div class="actions" style="justify-content:flex-end;">
          <button id="btn-confirmar" class="btn primary">Confirmar devoluci√≥n/cambio</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal: Historial de ventas -->
  <div id="modal-ventas" class="modal" aria-hidden="true">
    <div class="box">
      <div class="head">
        <h3>Seleccionar venta</h3>
        <button id="mven-cerrar" class="btn sm">Cerrar</button>
      </div>
      <div class="toolbar">
        <input id="mven-buscar" type="text" placeholder="Buscar por ID, empleado‚Ä¶" />
      </div>
      <div class="scroll">
        <table>
          <thead>
            <tr>
              <th style="width:90px;">ID</th>
              <th>Fecha</th>
              <th class="right">Total</th>
              <th>Empleado</th>
            </tr>
          </thead>
          <tbody id="mven-rows"></tbody>
        </table>
      </div>
      <div class="foot">
        <small class="muted">Toc√° una fila para usar esa venta.</small>
      </div>
    </div>
  </div>

  <!-- Modal: Selecci√≥n de producto y variantes -->
  <div id="modal-variantes" class="modal" aria-hidden="true">
    <div class="box">
      <div class="head">
        <h3>Elegir producto y variante para el cambio</h3>
        <button id="mvar-cerrar" class="btn sm">Cerrar</button>
      </div>

      <div class="grid-2">
        <div>
          <label class="small">Buscar producto</label>
          <div class="toolbar">
            <input id="mvar-buscar-prod" type="text" placeholder="Filtrar por nombre o ID‚Ä¶" />
            <button id="mvar-recargar-prod" class="btn sm">Recargar</button>
          </div>
          <div class="scroll">
            <table>
              <thead>
                <tr><th style="width:90px;">ID</th><th>Producto</th><th class="right">Precio</th></tr>
              </thead>
              <tbody id="mvar-rows-prod"></tbody>
            </table>
          </div>
        </div>

        <div>
          <label class="small">Variantes del producto seleccionado</label>
          <div class="scroll">
            <table>
              <thead>
                <tr><th style="width:90px;">Var ID</th><th>Talle</th><th>Color</th><th class="right">Stock</th></tr>
              </thead>
              <tbody id="mvar-rows-var"></tbody>
            </table>
          </div>
          <div class="foot">
            <small class="muted">Toc√° una variante para seleccionar.</small>
          </div>
        </div>
      </div>

      <div class="foot" style="justify-content:space-between;">
        <div class="muted" id="mvar-seleccion">Sin selecci√≥n</div>
        <button id="mvar-usar" class="btn primary" disabled>Usar esta variante</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/devoluciones.js"></script>
</body>
</html>
